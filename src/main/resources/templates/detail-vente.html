<!DOCTYPE html>
<html>
<head th:insert="~{fragments/fragment-head :: head}">
<title>ENI-Enchères</title>
</head>
<body>

	<header>
		<h1 id="nav-title">
			<a th:href="@{/}">ENI-Enchères</a>
		</h1>
	</header>

	<h2>Détail vente</h2>
	<h3 th:if="${today >= article.dateFinEncheres 
			  and (etatVente == 'ET' or etatVente == 'RE')}" 
			  th:text="|'${pseudoAcheteur}' a remporté l'enchère.|">Affichage gagnant</h3>
	
	<div class="item-container">
	
		<p th:text="${article.nomArticle} ?: 'Nom inconnu'"></p>
		<img th:src="'/images/' + ${article.photoArticle}" th:alt="${article.nomArticle}">
		
		<div th:if="${etatVente == 'CR' or etatVente == 'EC'}">
			<div>
				<p th:text="${article.descriptions != null} ? |Description : ${article.descriptions}| : 'Aucune description'"></p>
				<p th:text="${article.categorie.libelle != null} ? 'Catégorie : ' + ${article.categorie.libelle} : 'Categorie non renseignée'"></p>
			</div>
		</div>

		<p th:text="${enchere != 0} ? | Meilleure offre : ${enchere} (pts) par ${pseudoAcheteur}| : 'Aucune offre'"></p>
		<p th:text="|Mise à prix : ${article.miseAPrix} points|">Mise à prix (points) :</p><br>
		
		
		<p th:if="${article.dateDebutEncheres >= today}"  
		   th:text="|Début de l'enchère : ${#temporals.format(article.dateDebutEncheres, 'dd/MM/yyyy')}|">Début de l'enchère</p>
		   
		<p th:text="|Fin de l'enchère : ${#temporals.format(article.dateFinEncheres, 'dd/MM/yyyy')}|">Fin de l'enchère</p>
		
	    
		<fieldset>
		<p>Retrait :</p>
		<p th:text="${article.retrait.rue}">Rue</p>
		<p th:text="|${article.retrait.codePostal} ${article.retrait.ville}|">Code postal + Ville</p><br>
		</fieldset>
		<p th:text="'Vendeur : ' +${article.utilisateur.pseudo}">Vendeur</p><br>
		
		<div th:if="${utilisateurEnSession != null 
					and utilisateurEnSession.idUtilisateur > 0 
					and article.utilisateur.idUtilisateur  != utilisateurEnSession.idUtilisateur 
					and venteEnCours == 'EC'}">
			<form th:action="@{/encherir}" method="post">
				<label for="montant">Ma proposition :</label>
				<input type="hidden" name="idArticle" th:value="${article.idArticle}">
				<input type="number" id="montant" name="montant" th:min="${enchere != null and enchere >= article.miseAPrix} ? ${enchere + 1} : ${article.miseAPrix}"  required >
				<div>
					<button type="submit">Enchérir</button>
				</div>
			</form>
		</div>
		
		<div th:if="${utilisateurEnSession != null 
					and article.utilisateur.idUtilisateur == utilisateurEnSession.idUtilisateur 
					and article.dateDebutEncheres >= today && article.dateFinEncheres < today}">
					
			<form th:action="@{/annulerVente}" method="post">
			<input type="hidden" name ="idArticle" th:value="${article.idArticle}">
				<button type="submit">Annuler la vente</button>
			</form>
		</div>
		
		<div th:if="${utilisateurEnSession != null 
					and article.utilisateur.idUtilisateur == utilisateurEnSession.idUtilisateur 
					and article.dateFinEncheres < today}">
					
			<form th:if ="${venteTermine == 'ET'}" th:action="@{/retraitEffectue}" method="post">
				<input type="hidden" name="idArticle" th:value="${article.idArticle}">
				<button type="submit">Retrait effectué</button>
			</form>
			
			<form th:action="@{/contacterAcheteur}" method="post">
				<input type="hidden" th:value="${article.idArticle}">
				<button type="submit" th:text="'Contacter '" >Contacter acheteur</button>
			</form>
		</div>
		
		
	</div>

	<a class="button-retour" th:href="@{/}">Retour</a>
	<a class="button-retour" th:href="@{/modifierVente(arti=${article.getIdArticle()})}">Modifier</a>


</body>
</html>
